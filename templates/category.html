<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Study Category - Nurse Success Study Hub">
  <title id="pageTitle">Category - Nurse Success Study Hub</title>
  <link rel="stylesheet" href="/static/style.css">
  <link rel="stylesheet" href="/static/category-style.css">
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  
  <!-- Vercel Analytics -->
  <script defer src="https://cdn.vercel-analytics.com/v1/web.js"></script>
</head>
<body>
  <div class="container">
    <!-- Header with Back Button -->
    <div class="category-header">
      <a href="/" class="back-btn">‚Üê Back to Hub</a>
      <h1 id="categoryTitle"></h1>
      <p id="categoryDesc" class="category-description"></p>
    </div>

    <!-- Modules Grid -->
    <main class="modules-grid" id="modulesContainer">
      <!-- Modules will be loaded here by JavaScript -->
    </main>

    <!-- Footer -->
    <footer class="hub-footer">
      <p>&copy; 2025 Nurse Success Study Hub. Study smarter, succeed faster.</p>
    </footer>
  </div>

  <script>
    // Get category from URL
    const pathSegments = window.location.pathname.split('/');
    const categoryName = decodeURIComponent(pathSegments[pathSegments.length - 1]);

    const categoryIcons = {
      'Patient Care Management': 'üë•',
      'HESI': 'üìã',
      'Nursing Certifications': 'üèÜ',
      'Pharmacology': 'üíä'
    };

    const categoryDescriptions = {
      'Patient Care Management': 'Enhance your patient care and clinical management skills',
      'HESI': 'Prepare for HESI management assessments',
      'Nursing Certifications': 'Master content for nursing certification exams',
      'Pharmacology': 'Strengthen your pharmacology knowledge and drug understanding'
    };

    const prettyNameMap = {
      'Module_1': 'Module 1',
      'Module_2': 'Module 2',
      'Module_3': 'Module 3',
      'Module_4': 'Module 4',
      'Learning_Questions_Module_1_2': 'Learning Questions Module 1 and 2',
      'Learning_Questions_Module_3_4': 'Learning Questions Module 3 and 4',
      'Pharm_Quiz_1': 'Pharm Quiz 1',
      'Pharm_Quiz_2': 'Pharm Quiz 2',
      'Pharm_Quiz_3': 'Pharm Quiz 3',
      'Pharm_Quiz_4': 'Pharm Quiz 4',
      'CCRN_Test_1_Combined_QA': 'CCRN Test 1',
      'CCRN_Test_2_Combined_QA': 'CCRN Test 2',
      'CCRN_Test_3_Combined_QA': 'CCRN Test 3',
      'HESI_Delegating': 'HESI Delegating',
      'HESI_Leadership': 'HESI Leadership',
      'Hesi_Management': 'HESI Management',
      'HESI_Comprehensive': 'HESI Comprehensive'
    };

    // Module grouping - defines how to group modules by prefix
    const moduleGroupings = {
      'Nursing Certifications': {
        'CCRN': ['CCRN_Test_1_Combined_QA', 'CCRN_Test_2_Combined_QA', 'CCRN_Test_3_Combined_QA']
      },
      'Pharmacology': {
        'Pharm Quizzes': ['Pharm_Quiz_1', 'Pharm_Quiz_2', 'Pharm_Quiz_3', 'Pharm_Quiz_4']
      }
    };

    function prettifyName(name) {
      return prettyNameMap[name] || name.replace(/_/g, ' ');
    }

    async function loadCategory() {
      try {
        const res = await fetch('/api/categories');
        if (!res.ok) throw new Error('Failed to load categories');
        
        const categories = await res.json();
        const category = categories[categoryName];
        
        if (!category) {
          throw new Error('Category not found');
        }

        const icon = categoryIcons[categoryName] || 'üìö';
        document.getElementById('categoryTitle').textContent = `${icon} ${categoryName}`;
        document.getElementById('categoryDesc').textContent = categoryDescriptions[categoryName] || '';
        document.title = `${categoryName} - Nurse Success Study Hub`;

        const container = document.getElementById('modulesContainer');
        
        // Check if this category has groupings
        const groupings = moduleGroupings[categoryName];
        
        if (groupings) {
          // Use grouped display
          container.innerHTML = Object.entries(groupings).map(([groupName, modules]) => `
            <a href="/quiz?category=${encodeURIComponent(categoryName)}&subcategory=${encodeURIComponent(groupName)}" class="module-card">
              <div class="module-content">
                <h3>${groupName}</h3>
                <p class="module-action">Start Quiz ‚Üí</p>
              </div>
            </a>
          `).join('');
        } else {
          // Use individual module display (for categories without groupings)
          container.innerHTML = category.modules.map(moduleName => `
            <a href="/quiz/${encodeURIComponent(moduleName)}?category=${encodeURIComponent(categoryName)}" class="module-card">
              <div class="module-content">
                <h3>${prettifyName(moduleName)}</h3>
                <p class="module-action">Start Quiz ‚Üí</p>
              </div>
            </a>
          `).join('');
        }
      } catch (error) {
        console.error('Error loading category:', error);
        document.getElementById('modulesContainer').innerHTML = `
          <div style="grid-column: 1/-1; padding: 40px; text-align: center; color: var(--danger);">
            <p>Error loading category. <a href="/">Return to home</a></p>
          </div>
        `;
      }
    }

    loadCategory();
  </script>
</body>
</html>
