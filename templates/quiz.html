<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>{{ module_name | replace('_', ' ') }} - Nurse Success Study Hub</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='quiz-style.css') }}">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/static/manifest.json">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#2f61f3">
    
    <!-- PWA Specific -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Nurse Study">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/static/icons/icon-180.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/static/icons/icon-120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/static/icons/icon-152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/static/icons/icon-167.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/icons/icon-180.png">
    
    <style>
        /* Offline indicator */
        .offline-indicator {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: white;
            padding: 12px 20px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
            z-index: 10000;
            display: none;
        }
        .offline-indicator.visible { display: block; }

        /* Category breakdown styles */
        .category-breakdown {
            margin-top: 24px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        .category-breakdown h3 {
            margin: 0 0 16px 0;
            font-size: 1.1em;
            color: #333;
        }
        .category-results {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .category-result-item {
            background: white;
            border-radius: 8px;
            padding: 14px;
            border-left: 4px solid #4caf50;
        }
        .category-result-item.needs-work {
            border-left-color: #f44336;
        }
        .category-result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .category-result-header .category-name {
            font-weight: 600;
            color: #333;
            font-size: 0.95em;
        }
        .category-result-header .category-weight {
            background: rgba(47, 97, 243, 0.1);
            color: #2f61f3;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
        }
        .category-result-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        .category-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        .category-bar-fill.green { background: #4caf50; }
        .category-bar-fill.yellow { background: #ff9800; }
        .category-bar-fill.red { background: #f44336; }
        .category-result-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85em;
        }
        .category-score {
            font-weight: 700;
        }
        .category-score.green { color: #4caf50; }
        .category-score.yellow { color: #ff9800; }
        .category-score.red { color: #f44336; }
        .category-count {
            color: #666;
        }
        .practice-weak-btn {
            display: inline-block;
            margin-top: 10px;
            padding: 6px 12px;
            background: transparent;
            border: 2px solid #2f61f3;
            color: #2f61f3;
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.8em;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        .practice-weak-btn:hover {
            background: #2f61f3;
            color: white;
        }
        .weak-areas-prompt {
            margin-top: 20px;
            padding: 16px;
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            border-radius: 8px;
        }
        .weak-areas-prompt h4 {
            margin: 0 0 8px 0;
            color: #e65100;
            font-size: 1em;
        }
        .weak-areas-prompt p {
            margin: 0 0 12px 0;
            color: #555;
            font-size: 0.9em;
        }
        .weak-areas-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .weak-area-link {
            display: inline-block;
            padding: 6px 12px;
            background: #ff9800;
            color: white;
            border-radius: 20px;
            text-decoration: none;
            font-size: 0.85em;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        .weak-area-link:hover {
            background: #f57c00;
        }
        .review-category {
            margin-top: 8px;
        }
        .category-tag {
            display: inline-block;
            padding: 2px 8px;
            background: rgba(47, 97, 243, 0.1);
            color: #2f61f3;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 500;
        }

        /* Safe area insets for iOS PWA */
        @supports (padding-top: env(safe-area-inset-top)) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
                padding-left: env(safe-area-inset-left);
                padding-right: env(safe-area-inset-right);
            }
        }
    </style>
</head>
<body>
    <!-- Offline indicator -->
    <div id="offlineIndicator" class="offline-indicator">
        <span>üì¥ You're offline - Using cached content</span>
    </div>

    <div class="container quiz-container">
        <a href="{{ back_url }}" class="back-link">‚Üê {{ back_label }}</a>
        
        <h1 id="pageTitle" class="quiz-title">{{ module_name | replace('_', ' ') }}</h1>
        
        <!-- Progress Bar -->
        <div id="progressBar" class="progress-bar hidden">
            <div id="progressFill" class="progress-fill"></div>
            <span id="progressLabel" class="progress-label"></span>
        </div>

        <!-- Counters -->
        <div id="countersBox" class="counters-box hidden">
            <span>Answered: <strong id="runCounter">0</strong></span>
            <span>Remaining: <strong id="remainingCounter">0</strong></span>
        </div>

        <!-- Launcher (hidden since we preload data) -->
        <div id="launcher" class="launcher hidden">
            <div id="moduleSelector" class="module-selector hidden"></div>
            
            <div id="lengthSelectorContainer" class="length-selector">
                <label>Quiz Length:</label>
                <div id="lengthBtns" class="length-buttons">
                    <button class="length-btn active" data-len="10">10 Questions</button>
                    <button class="length-btn" data-len="25">25 Questions</button>
                    <button class="length-btn" data-len="50">50 Questions</button>
                    <button class="length-btn" data-len="full">Full Module Question Bank</button>
                </div>
            </div>
            
            <button id="startBtn" class="start-btn">Start Quiz</button>
            
            <div id="resumeContainer" class="resume-container hidden">
                <p id="remainingQuestionsCount"></p>
                <button id="resumeBtn" class="resume-btn">Resume Previous Quiz</button>
            </div>
        </div>

        <!-- Quiz Interface -->
        <div id="quiz" class="quiz-interface hidden">
            <div id="questionText" class="question-text"></div>
            <form id="optionsForm" class="options-form"></form>
            <button id="submitBtn" class="submit-btn">Submit Answer</button>
            <div id="feedback" class="feedback hidden">Click to continue ‚Üí</div>
            <div id="answerLine" class="answer-line"></div>
            <div id="rationale" class="rationale"></div>
        </div>

        <!-- Reset button -->
        <button id="resetAll" class="reset-btn hidden">Reset Quiz</button>

        <!-- Summary -->
        <div id="summary" class="summary hidden">
            <h2>Quiz Complete!</h2>
            <div id="firstTrySummary" class="first-try-summary"></div>
            <button id="retryMissedBtn" class="retry-missed-btn hidden">Retry Missed Questions</button>
            <div id="reviewList" class="review-list"></div>
            <button id="restartBtnSummary" class="restart-btn">Start New Quiz</button>
        </div>
    </div>

    <!-- PWA Utilities -->
    <script src="/static/js/pwa-utils.js"></script>

    <!-- Preload quiz data -->
    <script>
        window.PRELOADED_QUIZ_DATA = {{ quiz_data | tojson | safe }};
        window.PRELOADED_MODULE_NAME = {{ module_name | tojson | safe }};
        window.AUTO_START_QUIZ = {{ autostart | tojson | safe }};
        window.IS_COMPREHENSIVE = {{ is_comprehensive | default(false) | tojson | safe }};
        window.IS_CATEGORY_QUIZ = {{ is_category_quiz | default(false) | tojson | safe }};
        window.CUSTOM_HEADER_TITLE = {{ module_name | replace('_', ' ') | tojson | safe }};
    </script>

    <!-- Quiz Script -->
    <script src="{{ url_for('static', filename='quiz-script.js') }}"></script>
</body>
</html>
