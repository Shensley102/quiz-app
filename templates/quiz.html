<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Take the {{ quiz_name }} quiz">
    <meta name="theme-color" content="#1e40af">
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>{{ quiz_name }} - Nurse Success Study Hub</title>
    
    <!-- Manifest & Icons -->
    <link rel="manifest" href="/static/manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="/static/icons/icon-192.png">
    <link rel="apple-touch-icon" href="/static/icons/icon-180.png">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/quiz-style.css">
</head>
<body class="quiz-page">
    <!-- Header -->
    <header class="quiz-header">
        <div class="header-content">
            <a href="/category/{{ category_name }}" class="back-button" aria-label="Back to category">
                <span class="back-icon">‚Üê</span> Back
            </a>
            
            <div class="quiz-title-section">
                <h1 class="quiz-title">{{ quiz_name }}</h1>
            </div>
            
            <!-- Progress Bar -->
            <div class="progress-section">
                <div class="progress-bar" id="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="progress-text">
                    <span id="progress-count">0</span> / <span id="total-count">0</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Offline Indicator -->
        <div id="offline-indicator" class="offline-banner" style="display: none;">
            <span class="offline-icon">üì°</span>
            <span class="offline-text">You're offline - content from cache</span>
        </div>

        <!-- Quiz Container -->
        <div id="quiz-container" class="quiz-container">
            <!-- Loading State -->
            <div id="loading-state" class="loading-state">
                <div class="spinner"></div>
                <p>Loading quiz...</p>
            </div>
            
            <!-- Quiz Content (populated by JavaScript) -->
            <div id="quiz-content" class="quiz-content" style="display: none;">
                <!-- Question will be inserted here -->
            </div>
            
            <!-- Error State -->
            <div id="error-state" class="error-state" style="display: none;">
                <div class="error-icon">‚ö†Ô∏è</div>
                <h2>Unable to Load Quiz</h2>
                <p id="error-message">There was an error loading the quiz data.</p>
                <a href="/category/{{ category_name }}" class="btn btn-primary">Back to Category</a>
            </div>
            
            <!-- Results State -->
            <div id="results-state" class="results-state" style="display: none;">
                <div class="results-content">
                    <!-- Results populated by JavaScript -->
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script>
        // Quiz data
        const categoryName = '{{ category_name }}';
        const quizId = '{{ quiz_id }}';
        const quizFile = '{{ quiz_file }}';
        const quizName = '{{ quiz_name }}';
        
        // Load and initialize quiz
        loadQuiz();
        
        function loadQuiz() {
            const apiUrl = `/api/quiz/${categoryName}/${quizFile}`;
            
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    initializeQuiz(data);
                })
                .catch(error => {
                    console.error('Error loading quiz:', error);
                    showError(`Failed to load quiz: ${error.message}`);
                });
        }
        
        function initializeQuiz(quizData) {
            console.log('Quiz data loaded:', quizData);
            
            // Import quiz script
            const script = document.createElement('script');
            script.src = '/static/js/quiz-script.js';
            script.onload = function() {
                // Initialize quiz with data
                window.initializeQuiz && window.initializeQuiz(quizData, {
                    categoryName: categoryName,
                    quizId: quizId,
                    quizName: quizName
                });
            };
            script.onerror = function() {
                showError('Failed to load quiz interface');
            };
            document.head.appendChild(script);
        }
        
        function showError(message) {
            document.getElementById('loading-state').style.display = 'none';
            document.getElementById('quiz-content').style.display = 'none';
            document.getElementById('error-state').style.display = 'flex';
            document.getElementById('error-message').textContent = message;
        }
        
        // Offline detection
        function updateOnlineStatus() {
            const indicator = document.getElementById('offline-indicator');
            if (navigator.onLine) {
                indicator.style.display = 'none';
            } else {
                indicator.style.display = 'flex';
            }
        }
        
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        updateOnlineStatus();
        
        // Back button
        document.querySelector('.back-button').addEventListener('click', function(e) {
            e.preventDefault();
            window.history.back();
        });
    </script>
</body>
</html>
