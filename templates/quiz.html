<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Quiz - Nurse Success Study Hub">
  <title id="pageTitle">Quiz - Nurse Success Study Hub</title>
  <link rel="stylesheet" href="/static/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  
  <!-- Vercel Analytics -->
  <script defer src="https://cdn.vercel-analytics.com/v1/web.js"></script>
</head>
<body>
  <div class="container">
    <!-- Title Bar -->
    <div class="title-bar">
      <div>
        <a href="/" style="color: var(--primary); text-decoration: none; font-weight: 600; margin-bottom: 4px; display: inline-block; font-size: 14px;">‚Üê Nurse Success Study Hub</a>
        <h1 id="quizTitle">Select a Module</h1>
        <p id="quizDescription" style="color: var(--ink-soft); margin: 8px 0 0 0; font-size: 14px; display: none;"></p>
      </div>
      <div id="resumeContainer" class="resume-container hidden">
        <span id="remainingQuestionsCount" class="remaining-count"></span>
        <button class="btn btn-blue" id="resumeBtn">Resume Quiz</button>
      </div>
    </div>

    <!-- Setup Card -->
    <div class="card" id="launcher">
      <h2>Quiz Setup</h2>
      
      <div class="field">
        <label for="moduleSel">Select Module:</label>
        <select id="moduleSel">
          <option value="">Loading modules...</option>
        </select>
      </div>

      <div class="field">
        <label>How many questions?</label>
        <div class="seg" id="lengthBtns">
          <button class="seg-btn active" data-len="10">10 Questions</button>
          <button class="seg-btn" data-len="25">25 Questions</button>
          <button class="seg-btn" data-len="50">50 Questions</button>
          <button class="seg-btn" data-len="full">Full Module Question Bank</button>
        </div>
      </div>

      <div class="actions">
        <button class="btn primary" id="startBtn">Start Quiz</button>
      </div>

      <!-- How This Quiz Works -->
      <div class="help">
        <h3>How This Quiz Works</h3>
        <ul>
          <li><strong>Select All That Apply (SATA):</strong> Some questions allow multiple correct answers. Select all options you believe are correct.</li>
          <li><strong>Single Answer:</strong> Questions without "Select all that apply" have only one correct answer.</li>
          <li><strong>Mastery System:</strong> If you answer incorrectly, the question will reappear. The quiz ends when all questions are answered correctly.</li>
          <li><strong>Keyboard Shortcuts:</strong> Press A-D to select answers, Enter to submit.</li>
          <li><strong>Resume Feature:</strong> If you select "Full Module Question Bank", your progress is saved and you can resume later.</li>
        </ul>
      </div>
    </div>

    <!-- Quiz Card -->
    <div class="card hidden" id="quiz">
      <!-- Counters -->
      <div id="countersBox" class="hidden">
        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; flex-wrap: wrap; gap: 8px;">
          <span id="runCounter" style="font-weight: 600; font-size: 14px;">Question: 1</span>
          <span id="remainingCounter" style="font-weight: 600; font-size: 14px;">Remaining to master: 0</span>
        </div>
        <div style="position: relative; margin-bottom: 16px;">
          <div id="progressBar" class="pbar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
            <div id="progressFill" class="pbar-fill"></div>
            <div id="progressLabel" class="pbar-label">0% mastered</div>
          </div>
        </div>
      </div>

      <div id="questionText" class="question"></div>
      <form id="optionsForm" class="options"></form>
      <div id="feedback" class="feedback hidden"></div>
      <div id="answerLine" class="answer-line hidden"></div>
      <div id="rationale" class="rationale hidden"></div>

      <div class="actions">
        <button class="btn primary" id="submitBtn">Submit Answer</button>
      </div>
    </div>

    <!-- Summary Card -->
    <div class="card hidden" id="summary">
      <h2>Quiz Complete! üéâ</h2>
      <div id="firstTrySummary" class="first-try hidden"></div>

      <!-- Action Buttons -->
      <div class="actions" style="margin-bottom: 24px;">
        <button class="btn danger hidden" id="retryMissedBtn">Retry <span id="missedCount">0</span> Missed Questions</button>
        <button class="btn primary" id="restartBtnSummary">Start New Quiz</button>
      </div>

      <!-- Help Section -->
      <div class="help" style="margin-top: 0; margin-bottom: 32px;">
        <h3>Need More Practice?</h3>
        <ul>
          <li>Review the rationales for questions you missed</li>
          <li>Try the "Retry Missed Questions" feature to focus on weak areas</li>
          <li>Consider a shorter quiz length for more frequent practice sessions</li>
          <li>Use the keyboard shortcuts (A-D, Enter) for faster navigation</li>
        </ul>
      </div>

      <h3>Review Your Answers:</h3>
      <div id="reviewList" class="review-list"></div>
    </div>

    <!-- Reset Button (hidden initially) -->
    <button class="btn danger hidden" id="resetAll" style="position: fixed; top: 20px; right: 20px; z-index: 1000;">Reset Quiz</button>
  </div>

  <script src="/static/quiz-script.js"></script>
</body>
</html>
